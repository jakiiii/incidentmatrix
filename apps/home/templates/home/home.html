{% extends 'base.html' %}
{% load static %}
{% block title %}{{ title }} || {{ block.super }}{% endblock title %}


{% block content %}
    <div class="row">
        <div class="col-xl-12">
            <div class="row">
                <div class="col-lg-4">
                    <div class="card">
                        <a href="{% url 'incident:incident_list_maps' %}?country_code=BD">
                            <div class="card-body">
                                <div class="d-flex flex-row">
                                    <div class="col-6">
                                        <div class="h4">BANGLADESH</div>
                                    </div>
                                    <div class="col-6 align-self-center text-right">
                                        <div class="m-l-10">
                                            <h5 class="mt-0">{{ incident_of_bd }}</h5>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end card-body-->
                        </a>
                    </div><!--end card-->
                </div><!--end col-->

                <div class="col-lg-4">
                    <div class="card">
                        <a href="{% url 'incident:incident_list_maps' %}?country_code=IN">
                            <div class="card-body">
                                <div class="d-flex flex-row">
                                    <div class="col-6">
                                        <div class="h4">INDIA</div>
                                    </div>
                                    <div class="col-6 align-self-center text-right">
                                        <div class="m-l-10">
                                            <h5 class="mt-0">{{ incident_of_in }}</h5>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end card-body-->
                        </a>
                    </div><!--end card-->
                </div><!--end col-->

                <div class="col-lg-4">
                    <div class="card">
                        <a href="{% url 'incident:incident_list_maps' %}?country_code=MM">
                            <div class="card-body">
                                <div class="d-flex flex-row">
                                    <div class="col-6">
                                        <div class="h4">MYANMAR</div>
                                    </div>
                                    <div class="col-6 align-self-center text-right">
                                        <div class="m-l-10">
                                            <h5 class="mt-0">{{ incident_of_mm }}</h5>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end card-body-->
                        </a>
                    </div><!--end card-->
                </div><!--end col-->
            </div><!--end row-->
        </div><!--end col-->
    </div><!--end row-->

    <!-- end page title end breadcrumb -->
    <div class="row">
        <div class="col-xl-8">
            <div class="card">
                <div class="card-body">
                    <h4 class="mt-0 header-title">বিগত ইন্সিডেন্ট</h4>
                    <div style="height: 400px;">
                        <canvas id="incident-line-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="header-title mt-0  mb-3">Donut Chart</h5>
                    <div id="donut-incident" style="height: 398px;"></div>
                </div><!--end card-body-->
            </div><!--end card-->
        </div><!--end col-->
    </div><!--end row-->

    <div class="row">
        <!-- Division Card -->
        <div class="col-md-6 col-lg-6 col-xl-3 mb-3">
            <div class="card equal-card-height">
                <div class="card-body equal-card-body">
                    <h4 class="card-title font-20 mt-0">বিভাগ</h4>
                    <input type="text" class="form-control mb-2 search-input" placeholder="অনুসন্ধান করুন...">
                </div>
                <ul class="list-group list-group-flush equal-card-list">
                    {% for context in division_context %}
                        <li class="list-group-item">
                            <a href="{% url 'incident:incident_list_maps' %}?division_id={{ context.id }}"
                               class="text-dark">{{ context.name_bn }}({{ context.name_en }})</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- District Card -->
        <div class="col-md-6 col-lg-6 col-xl-3 mb-3">
            <div class="card equal-card-height">
                <div class="card-body equal-card-body">
                    <h4 class="card-title font-20 mt-0">জেলা</h4>
                    <input type="text" class="form-control mb-2 search-input" placeholder="অনুসন্ধান করুন...">
                </div>
                <ul class="list-group list-group-flush equal-card-list">
                    {% for context in district_context %}
                        <li class="list-group-item">
                            <a href="{% url 'incident:incident_list_maps' %}?district_id={{ context.id }}"
                               class="text-dark">{{ context.name_bn }}
                                ({{ context.name_en }})</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Incident Type Card -->
        <div class="col-md-6 col-lg-6 col-xl-3 mb-3">
            <div class="card equal-card-height">
                <div class="card-body equal-card-body">
                    <h4 class="card-title font-20 mt-0">ঘটনার ধরণ</h4>
                    <input type="text" class="form-control mb-2 search-input" placeholder="অনুসন্ধান করুন...">
                </div>
                <ul class="list-group list-group-flush equal-card-list">
                    {% for context in incident_type_context %}
                        <li class="list-group-item">
                            <a href="{% url 'incident:incident_list_maps' %}?incident_type_id={{ context.id }}"
                               class="text-dark">{{ context.name_bn }}
                                ({{ context.name_en }})</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Involved Actor Card -->
        <div class="col-md-6 col-lg-6 col-xl-3 mb-3">
            <div class="card equal-card-height">
                <div class="card-body equal-card-body">
                    <h4 class="card-title font-20 mt-0">জড়িত ব্যক্তি/গোষ্ঠী/সংগঠন</h4>
                    <input type="text" class="form-control mb-2 search-input" placeholder="অনুসন্ধান করুন...">
                </div>
                <ul class="list-group list-group-flush equal-card-list">
                    {% for context in incident_actor_context %}
                        <li class="list-group-item">
                            <a href="{% url 'incident:incident_list_maps' %}?involved_actor_id={{ context.id }}"
                               class="text-dark">{{ context.name_bn }}
                                ({{ context.name_en }})</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Select all search boxes on the page
            const searchBoxes = document.querySelectorAll('.search-input');

            searchBoxes.forEach(function (searchBox) {
                searchBox.addEventListener('input', function () {
                    const query = this.value.toLowerCase();
                    const list = this.closest('.card').querySelector('.list-group');
                    const items = list.querySelectorAll('li');

                    items.forEach(function (item) {
                        const text = item.textContent.toLowerCase();
                        if (text.includes(query)) {
                            item.style.display = '';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            new Morris.Donut({
                element: 'donut-incident',
                data: {{ donut_chart_data|safe }},
                colors: {{ donut_chart_colors|safe }},
                resize: true
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('incident-line-chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ chart_labels|safe }},
                datasets: {{ chart_datasets|safe }}
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 12,
                            font: {size: 10}
                        }
                    },
                    title: {
                        display: false
                    }
                },
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
    </script>

{% endblock %}
